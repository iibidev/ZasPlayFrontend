<div class="container">
    <h1 style="margin-bottom: 15px;">Editar perfil</h1>
    <form class="editForm">
        <p>Avatar</p>
        <div class="editForm__pic">
            <img class="pic__profilePic" id="profilePic" [src]="userService.user()!.profilePic" alt="Tu foto de perfil">
            <button type="button" class="pic__changeBtn" (click)="showPicOptions = true">Cambiar</button>
        </div>
        <div style="margin-top: 15px; width: 100%; position: relative;">
            <label for="username">Usuario:</label>
            <input type="text" id="username" name="username" class="form__username" placeholder="_-Example420-_" [(ngModel)]="username" autocomplete="off">
            <span [classList]="username.length > 16 ? 'usernameChars invalidChars' : 'usernameChars'">{{ 16 - username.length }}</span>
        </div>
        @if (showError) {
            <p id="errorMsg">{{ errorMsg }}</p>
        }
        <button type="submit" class="form__submit" (click)="updateUser()">Guardar cambios</button>
    </form>
    <button style="all: unset; margin-top: 15px; cursor: pointer;" (click)="back()">Volver</button>
    
    @if (showPicOptions) {
        <div class="picOptions">
            <p>Selecciona una opción</p>
            <div style="width: 100%; display: flex; gap: 10px;">
                <label for="changePic" class="picOptions__option">
                    <svg width="45" height="45" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 13.4375C22 17.2087 22 19.0944 20.8284 20.2659C19.6569 21.4375 17.7712 21.4375 14 21.4375H10C6.22876 21.4375 4.34315 21.4375 3.17157 20.2659C2 19.0944 2 17.2087 2 13.4375C2 9.66626 2 7.78065 3.17157 6.60907C4.34315 5.4375 6.22876 5.4375 10 5.4375H14C17.7712 5.4375 19.6569 5.4375 20.8284 6.60907C21.4921 7.27271 21.7798 8.16545 21.9045 9.50024" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M3.98779 6C4.10022 5.06898 4.33494 4.42559 4.82498 3.93726C5.76553 3 7.27932 3 10.3069 3H13.5181C16.5457 3 18.0595 3 19 3.93726C19.4901 4.42559 19.7248 5.06898 19.8372 6" stroke="white" stroke-width="1.5"/>
                        <circle cx="17.5" cy="9.9375" r="1.5" stroke="white" stroke-width="1.5"/>
                        <path d="M2 13.9376L3.75159 12.405C4.66286 11.6077 6.03628 11.6534 6.89249 12.5096L11.1822 16.7993C11.8694 17.4866 12.9512 17.5803 13.7464 17.0214L14.0446 16.8119C15.1888 16.0077 16.7369 16.1009 17.7765 17.0365L21 19.9376" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    <p>Elegir de la galería</p>
                </label>
                <input type="file" id="changePic" accept="image/*" style="display: none;" (change)="updateProfilePic($event)">
                <div class="picOptions__option" (click)="showAvatars = true">
                    <svg width="45" height="45" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                        <path d="m 8 1 c -1.65625 0 -3 1.34375 -3 3 s 1.34375 3 3 3 s 3 -1.34375 3 -3 s -1.34375 -3 -3 -3 z m -1.5 7 c -2.492188 0 -4.5 2.007812 -4.5 4.5 v 0.5 c 0 1.109375 0.890625 2 2 2 h 8 c 1.109375 0 2 -0.890625 2 -2 v -0.5 c 0 -2.492188 -2.007812 -4.5 -4.5 -4.5 z m 0 0" fill="white"/>
                    </svg>
                    Elegir un avatar
                </div>
            </div>
        </div>
        <div class="back" (click)="closePicOptions()"></div>
    }

    @if (showAvatars && showPicOptions) {
        <div class="avatares">
            <p class="avatares__title">Selecciona un avatar</p>
            <div class="avatares__pics">
                    @for (pic of avatarPics; track $index) {
                        <img [src]="pic" [id]="'avatar' + $index" #image (click)="changeAvatar(image)" class="avatares__pic">
                    }
            </div>
            <button class="avatares__saveBtn" (click)="updateAvatar()">Guardar</button>
        </div>
    }
    
    @if (showLoader) {
        <app-loader [text]="'Actualizando perfil...'"></app-loader>
    }
</div>
